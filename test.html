<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>æˆ‘çš„éƒ¨è½æ ¼ï½œä¸€é å¼ Starter</title>
  <meta name="description" content="ä¸€å€‹é›¶å¾Œç«¯ã€å¯æœå°‹ã€å¯åˆ†é¡ã€å¯æ·±è‰²æ¨¡å¼çš„ç´”å‰ç«¯éƒ¨è½æ ¼èµ·æ‰‹æª”ã€‚"/>
  <style>
    :root {
      --bg: #0b0c10;
      --fg: #eaeef2;
      --muted: #9aa4af;
      --card: #121318;
      --accent: #4f46e5; /* indigo */
      --ring: #6366f1;
    }
    :root.light {
      --bg: #f7fafc;
      --fg: #0f172a;
      --muted: #475569;
      --card: #ffffff;
      --accent: #2563eb;
      --ring: #60a5fa;
    }
    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      margin: 0; font: 16px/1.6 system-ui, -apple-system, Segoe UI, Roboto, Noto Sans, "Helvetica Neue", Arial, "Apple Color Emoji", "Segoe UI Emoji";
      background: var(--bg); color: var(--fg);
      transition: background .2s ease, color .2s ease;
    }
    a { color: var(--accent); text-decoration: none; }
    a:hover { text-decoration: underline; }
    .container { max-width: 920px; margin: 0 auto; padding: 24px; }
    header { display:flex; align-items:center; gap:12px; justify-content: space-between; margin-bottom: 16px; }
    .brand { display:flex; align-items:center; gap:12px; }
    .brand h1 { margin: 0; font-size: 20px; font-weight: 700; }
    .chip { font-size:12px; padding:4px 8px; border-radius:999px; background: var(--card); color: var(--muted); border:1px solid rgba(255,255,255,.08); }
    .toolbar { display:flex; gap:8px; align-items:center; }
    .btn { padding:8px 12px; border-radius: 12px; border: 1px solid rgba(255,255,255,.1); background: var(--card); color: var(--fg); cursor:pointer; }
    .btn:focus { outline: 2px solid var(--ring); outline-offset: 2px; }
    .search { flex:1; min-width: 220px; }
    input[type="search"] { width:100%; padding:10px 12px; border-radius:12px; background: var(--card); color: var(--fg); border:1px solid rgba(255,255,255,.1); }
    main { display: grid; grid-template-columns: 1fr; gap: 16px; }
    @media (min-width: 960px) { main { grid-template-columns: 1fr 280px; } }
    .card { background: var(--card); border:1px solid rgba(255,255,255,.08); border-radius: 16px; padding: 16px; }
    .post-list { display:grid; gap:12px; }
    .post-item { display:block; padding:16px; border-radius:12px; border:1px solid rgba(255,255,255,.06); background: transparent; }
    .post-item:hover { background: rgba(255,255,255,.03); text-decoration:none; }
    .post-item h3 { margin: 0 0 6px; font-size: 18px; }
    .post-item .meta { color: var(--muted); font-size: 13px; }
    .tags { display:flex; flex-wrap:wrap; gap:6px; margin-top:8px; }
    .tag { font-size:12px; padding:2px 8px; border-radius:999px; border:1px solid rgba(255,255,255,.08); color: var(--muted); }
    .sidebar { display:grid; gap:16px; }
    .sticky { position: sticky; top: 16px; }
    .post { padding: 8px 0; }
    .post h1 { margin-top: 0; }
    .post pre { overflow:auto; padding:12px; border-radius:12px; background: #0b1220; color:#e2e8f0; border:1px solid rgba(255,255,255,.08); }
    .post code { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; }
    .post img { max-width: 100%; border-radius: 12px; }
    footer { margin-top: 24px; color: var(--muted); font-size: 14px; text-align:center; }
    .hidden { display:none; }
    .nav { display:flex; gap:8px; flex-wrap:wrap; }
    .pill { padding:6px 10px; border-radius: 999px; border:1px solid rgba(255,255,255,.1); background: transparent; color: var(--fg); cursor:pointer; font-size: 13px; }
    .pill.active { background: var(--accent); color: white; border-color: var(--accent); }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div class="brand" role="banner">
        <span aria-hidden="true" style="display:inline-block;width:28px;height:28px;border-radius:8px;background:var(--accent);"></span>
        <h1>æˆ‘çš„éƒ¨è½æ ¼</h1>
        <span class="chip">é›¶å¾Œç«¯ / ç´”å‰ç«¯</span>
      </div>
      <div class="toolbar" role="search">
        <input id="q" class="search" type="search" placeholder="æœå°‹æ–‡ç« ã€#æ¨™ç±¤â€¦ (e.g. #JS RWD)" aria-label="æœå°‹" />
        <button id="themeBtn" class="btn" aria-label="åˆ‡æ›æ·±æ·ºè‰²">ğŸŒ—</button>
        <button id="newBtn" class="btn" aria-label="å»ºç«‹æ–‡ç« ">ï¼‹</button>
      </div>
    </header>

    <main>
      <section id="listView" class="card" aria-live="polite">
        <div class="nav" id="tagNav"></div>
        <div id="postList" class="post-list"></div>
      </section>

      <aside class="sidebar">
        <div class="card sticky">
          <h3 style="margin-top:0">å¿«é€Ÿèªªæ˜</h3>
          <ul>
            <li>å–®ä¸€ HTML æª”ï¼Œç„¡éœ€ä¼ºæœå™¨</li>
            <li>æ”¯æ´æœå°‹èˆ‡#æ¨™ç±¤éæ¿¾</li>
            <li>æ·±è‰²/æ·ºè‰²æ¨¡å¼</li>
            <li>æ–‡ç« å„²å­˜åœ¨ç€è¦½å™¨ (localStorage)</li>
            <li>å¯åŒ¯å‡º/åŒ¯å…¥ JSON å‚™ä»½</li>
          </ul>
          <div style="display:flex; gap:8px; flex-wrap:wrap; margin-top:8px">
            <button id="exportBtn" class="btn">åŒ¯å‡º JSON</button>
            <label class="btn" for="importFile" style="cursor:pointer">åŒ¯å…¥ JSON</label>
            <input id="importFile" type="file" accept="application/json" class="hidden" />
          </div>
        </div>
      </aside>
    </main>

    <section id="postView" class="card hidden" aria-live="polite">
      <button id="backBtn" class="btn" aria-label="è¿”å›åˆ—è¡¨">â† è¿”å›</button>
      <article class="post" id="postContent"></article>
    </section>

    <section id="editor" class="card hidden" aria-live="polite">
      <h3 style="margin-top:0">âœï¸ æ’°å¯« / ç·¨è¼¯æ–‡ç« </h3>
      <div style="display:grid; gap:8px">
        <input id="titleInput" placeholder="æ¨™é¡Œ" />
        <input id="tagsInput" placeholder="#æ¨™ç±¤ ä»¥é€—è™Ÿåˆ†éš”ï¼Œä¾‹å¦‚ï¼š#JS, #ç”Ÿæ´»" />
        <textarea id="bodyInput" placeholder="æ”¯æ´ç°¡æ˜“ Markdownï¼š**ç²—é«”**ã€*æ–œé«”*ã€`ç¨‹å¼ç¢¼`ã€```å€å¡Š```ã€![alt](url)" rows="10"></textarea>
        <div style="display:flex; gap:8px; flex-wrap:wrap">
          <button id="saveBtn" class="btn">å„²å­˜</button>
          <button id="cancelBtn" class="btn">å–æ¶ˆ</button>
          <button id="deleteBtn" class="btn" title="åˆªé™¤æ­¤æ–‡">åˆªé™¤</button>
        </div>
      </div>
    </section>

    <footer>Â© <span id="year"></span> æˆ‘çš„éƒ¨è½æ ¼ Â· ç”±ç´”å‰ç«¯é©…å‹•</footer>
  </div>

  <script>
    // ---------- å°å¹«æ‰‹ ----------
    const $ = (sel) => document.querySelector(sel);
    const $$ = (sel) => Array.from(document.querySelectorAll(sel));
    const storageKey = 'mini-blog-posts-v1';

    function uid() { return Math.random().toString(36).slice(2) + Date.now().toString(36); }
    function fmtDate(ts){
      const d = new Date(ts); return `${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,'0')}-${String(d.getDate()).padStart(2,'0')}`;
    }

    // è¶…è¼•é‡ Markdown è½‰ HTMLï¼ˆåƒ…ç¤ºæ„ï¼‰
    function md(s=''){
      return s
        .replace(/^### (.*$)/gim, '<h3>$1</h3>')
        .replace(/^## (.*$)/gim, '<h2>$1</h2>')
        .replace(/^# (.*$)/gim, '<h1>$1</h1>')
        .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
        .replace(/\*(.*?)\*/g, '<em>$1</em>')
        .replace(/`([^`]+)`/g, '<code>$1</code>')
        .replace(/```([\s\S]*?)```/g, '<pre><code>$1</code></pre>')
        .replace(/!\[(.*?)\]\((.*?)\)/g, '<img alt="$1" src="$2"/>')
        .replace(/\n\n/g, '</p><p>')
    }

    // ---------- å‡è³‡æ–™ï¼ˆé¦–æ¬¡è¼‰å…¥ï¼‰ ----------
    const demoPosts = [
      {
        id: uid(),
        title: 'ä½ å¥½ï¼Œéƒ¨è½æ ¼ï¼',
        tags: ['#ç”Ÿæ´»', '#JS'],
        body: 'é€™æ˜¯ç¬¬ä¸€ç¯‡æ–‡ç« ã€‚\n\næ”¯æ´ **ç²—é«”**ã€*æ–œé«”*ã€`inline code`ã€ä»¥åŠ```\nconsole.log("Hello Blog")\n```\n\nä¹Ÿå¯ä»¥æ’å…¥åœ–ç‰‡ï¼š\n\n![å°é¢](https://images.unsplash.com/photo-1518791841217-8f162f1e1131?q=80&w=1200&auto=format&fit=crop)\n',
        ts: Date.now() - 1000*60*60*24*2
      },
      {
        id: uid(),
        title: 'RWD ç­†è¨˜ï¼šFlex vs Grid',
        tags: ['#CSS', '#RWD'],
        body: 'ç°¡è¨˜ï¼š\n\n- Flexï¼šä¸€ç¶­æ’åˆ—ï¼ˆä¸»è»¸ï¼‰\n- Gridï¼šäºŒç¶­å¸ƒå±€ï¼ˆè¡Œèˆ‡åˆ—ï¼‰\n\n**ä½•æ™‚ç”¨ï¼Ÿ**\n- éœ€è¦ç­‰é«˜å¡ç‰‡ï¼šGrid å¥½ç”¨\n- æ°´å¹³ç½®ä¸­åˆ†æ•£ï¼šFlex ç›´è¦º',
        ts: Date.now() - 1000*60*60*8
      },
      {
        id: uid(),
        title: 'ç”¨ fetch() è®€å…¬é–‹ API',
        tags: ['#JS', '#API'],
        body: 'æ•™å­¸ç‰‡æ®µï¼š```\nasync function load(){\n  const r = await fetch(\'https://api.github.com/repos\');\n  const data = await r.json();\n  console.log(data);\n}\n```',
        ts: Date.now() - 1000*60*30
      }
    ];

    // ---------- ç‹€æ…‹ ----------
    let posts = JSON.parse(localStorage.getItem(storageKey) || 'null');
    if(!posts){ posts = demoPosts; save(); }
    let current = null; // ç›®å‰ç·¨è¼¯æˆ–æª¢è¦–çš„ post id
    let currentFilter = null; // ç›®å‰ #tag ç¯©é¸

    function save(){ localStorage.setItem(storageKey, JSON.stringify(posts)); }

    // ---------- æ¸²æŸ“åˆ—è¡¨ ----------
    function renderList(){
      $('#postView').classList.add('hidden');
      $('#editor').classList.add('hidden');
      $('#listView').classList.remove('hidden');

      const q = $('#q').value.trim();
      let filtered = [...posts].sort((a,b)=>b.ts-a.ts);

      if(currentFilter){ filtered = filtered.filter(p => p.tags.includes(currentFilter)); }
      if(q){
        const qs = q.toLowerCase();
        filtered = filtered.filter(p =>
          p.title.toLowerCase().includes(qs) ||
          p.body.toLowerCase().includes(qs) ||
          p.tags.join(' ').toLowerCase().includes(qs)
        );
      }

      $('#postList').innerHTML = filtered.map(p => `
        <a class="post-item" href="#post-${p.id}" data-id="${p.id}">
          <h3>${p.title}</h3>
          <div class="meta">ç™¼å¸ƒæ–¼ ${fmtDate(p.ts)}</div>
          <div class="tags">${p.tags.map(t=>`<span class="tag">${t}</span>`).join('')}</div>
        </a>
      `).join('');

      // Tag å°è¦½
      const tags = Array.from(new Set(posts.flatMap(p => p.tags)));
      $('#tagNav').innerHTML = [`<button class="pill ${!currentFilter ? 'active':''}" data-tag="">å…¨éƒ¨</button>`]
        .concat(tags.map(t => `<button class="pill ${currentFilter===t?'active':''}" data-tag="${t}">${t}</button>`)).join('');

      // ç¶å®šé»æ“Š
      $$('#postList .post-item').forEach(a=>{
        a.addEventListener('click', (e)=>{
          e.preventDefault();
          const id = a.getAttribute('data-id');
          openPost(id);
        })
      });
      $$('#tagNav .pill').forEach(b=>{
        b.addEventListener('click', ()=>{
          const tag = b.getAttribute('data-tag');
          currentFilter = tag || null;
          renderList();
        })
      })
    }

    // ---------- é¡¯ç¤ºæ–‡ç«  ----------
    function openPost(id){
      const p = posts.find(x=>x.id===id);
      if(!p) return;
      current = id;
      $('#listView').classList.add('hidden');
      $('#editor').classList.add('hidden');
      $('#postView').classList.remove('hidden');
      $('#postContent').innerHTML = `
        <h1>${p.title}</h1>
        <div class="meta" style="color:var(--muted)">${fmtDate(p.ts)} Â· ${p.tags.map(t=>`<span class=tag>${t}</span>`).join(' ')}</div>
        <hr style="border:0;border-top:1px solid rgba(255,255,255,.08); margin:12px 0"/>
        <p>${md(p.body || '')}</p>
        <div style="display:flex; gap:8px; margin-top:16px">
          <button class="btn" id="editBtn">ç·¨è¼¯</button>
        </div>
      `;
      $('#editBtn').onclick = ()=> edit(id);
    }

    // ---------- ç·¨è¼¯å™¨ ----------
    function edit(id){
      const p = posts.find(x=>x.id===id) || { id: uid(), title:'', tags:[], body:'', ts: Date.now() };
      current = p.id;
      $('#listView').classList.add('hidden');
      $('#postView').classList.add('hidden');
      $('#editor').classList.remove('hidden');
      $('#titleInput').value = p.title;
      $('#tagsInput').value = p.tags.join(', ');
      $('#bodyInput').value = p.body;
    }

    function createNew(){ current = null; edit(uid()); }

    function savePost(){
      const title = $('#titleInput').value.trim() || 'æœªå‘½åæ–‡ç« ';
      const tags = $('#tagsInput').value.split(',').map(s=>s.trim()).filter(Boolean);
      const body = $('#bodyInput').value;
      let p = posts.find(x=>x.id===current);
      if(!p){ p = { id: current, title, tags, body, ts: Date.now() }; posts.push(p); }
      else { p.title = title; p.tags = tags; p.body = body; p.ts = Date.now(); }
      save(); renderList();
    }

    function deletePost(){
      if(!current) return;
      const i = posts.findIndex(x=>x.id===current);
      if(i>=0){ posts.splice(i,1); save(); }
      renderList();
    }

    // ---------- åŒ¯å…¥åŒ¯å‡º ----------
    function exportJSON(){
      const blob = new Blob([JSON.stringify(posts, null, 2)], {type:'application/json'});
      const a = document.createElement('a');
      a.href = URL.createObjectURL(blob);
      a.download = `blog-backup-${Date.now()}.json`;
      a.click();
    }
    function importJSON(file){
      const reader = new FileReader();
      reader.onload = () => {
        try{
          const data = JSON.parse(reader.result);
          if(Array.isArray(data)){
            posts = data; save(); renderList();
          } else { alert('åŒ¯å…¥æ ¼å¼éŒ¯èª¤'); }
        }catch(e){ alert('åŒ¯å…¥å¤±æ•—ï¼š' + e.message); }
      }
      reader.readAsText(file);
    }

    // ---------- ä¸»é¡Œ ----------
    function applyTheme(){
      const t = localStorage.getItem('theme') || 'dark';
      if(t==='light') document.documentElement.classList.add('light');
      else document.documentElement.classList.remove('light');
    }
    function toggleTheme(){
      const current = document.documentElement.classList.contains('light') ? 'light' : 'dark';
      const next = current==='light' ? 'dark' : 'light';
      localStorage.setItem('theme', next); applyTheme();
    }

    // ---------- äº‹ä»¶ ----------
    $('#q').addEventListener('input', renderList);
    $('#newBtn').addEventListener('click', createNew);
    $('#saveBtn').addEventListener('click', savePost);
    $('#cancelBtn').addEventListener('click', renderList);
    $('#deleteBtn').addEventListener('click', ()=>{ if(confirm('ç¢ºå®šåˆªé™¤ï¼Ÿ')) deletePost(); });
    $('#backBtn').addEventListener('click', renderList);
    $('#exportBtn').addEventListener('click', exportJSON);
    $('#importFile').addEventListener('change', e => { if(e.target.files[0]) importJSON(e.target.files[0]); });
    $('#themeBtn').addEventListener('click', toggleTheme);

    // ---------- å•Ÿå‹• ----------
    $('#year').textContent = new Date().getFullYear();
    applyTheme();
    renderList();

    // æ”¯æ´ URL hash ç›´æ¥é–‹æ–‡ï¼ˆ#post-<id>ï¼‰
    window.addEventListener('hashchange', ()=>{
      const m = location.hash.match(/^#post-(.+)$/);
      if(m){ openPost(m[1]); }
    });
  </script>
</body>
</html>
